# ðŸŽ¯ Quick Reference: How Everything Works

## ðŸ“Š Credit System at a Glance

### The Formula
```
Available Credits = (Plan Credits + Addon Credits) - Credits Used
```

---

## ðŸ‘¥ User Types & Behavior

### 1. **FREE USER** ðŸ‘¤
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan: Free              â”‚
â”‚ Credits: 0              â”‚
â”‚ Available: 0            â”‚
â”‚ Word Limit: 200/check   â”‚
â”‚                         â”‚
â”‚ Must upgrade to Pro     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **PRO USER** â­
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan: Pro ($20/month)   â”‚
â”‚ Plan Credits: 50,000    â”‚
â”‚ Addon: 0                â”‚
â”‚ Used: 0                 â”‚
â”‚ Available: 50,000       â”‚
â”‚                         â”‚
â”‚ âœ… Resets every 30 days â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After checking 15,000 words:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Credits: 50,000    â”‚ (unchanged)
â”‚ Used: 15,000            â”‚ (tracked)
â”‚ Available: 35,000       â”‚ (50k - 15k)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After 30 days:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Credits: 50,000    â”‚ (same)
â”‚ Used: 0                 â”‚ âœ… RESET!
â”‚ Available: 50,000       â”‚ (full again)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **PRO + ADDON** â­ðŸŽ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan: Pro               â”‚
â”‚ Plan Credits: 50,000    â”‚
â”‚ Addon: +10,000          â”‚ (bonus)
â”‚ Used: 0                 â”‚
â”‚ Available: 60,000       â”‚ (50k + 10k)
â”‚                         â”‚
â”‚ Addon expires: Mar 1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After checking 25,000 words:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Credits: 50,000    â”‚ (unchanged)
â”‚ Addon: 10,000           â”‚ (not consumed)
â”‚ Used: 25,000            â”‚ (tracked)
â”‚ Available: 35,000       â”‚ (60k - 25k)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After monthly reset (addon still valid):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Credits: 50,000    â”‚
â”‚ Addon: 10,000           â”‚ (still here!)
â”‚ Used: 0                 â”‚ âœ… RESET!
â”‚ Available: 60,000       â”‚ (reset + addon)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After addon expires:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Credits: 50,000    â”‚
â”‚ Addon: 0                â”‚ âŒ EXPIRED
â”‚ Used: 5,000             â”‚
â”‚ Available: 45,000       â”‚ (50k - 5k)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. **ENTERPRISE** ðŸ¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan: Free (custom)     â”‚
â”‚ Plan Credits: 100,000   â”‚ (admin set)
â”‚ Addon: 50,000           â”‚ (Q1 bonus)
â”‚ Used: 30,000            â”‚
â”‚ Available: 120,000      â”‚
â”‚                         â”‚
â”‚ âŒ NO monthly reset     â”‚
â”‚ Admin adds more manuallyâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Monthly Reset Logic

### Who Gets Monthly Reset?
```
âœ… Pro subscription users with active status
âŒ Free users
âŒ Enterprise users (custom credits)
âŒ Cancelled Pro users
```

### When Does Reset Happen?
```
Every 30 days from last reset date

Timeline:
Day 0:  creditsResetDate = "2026-01-01"
Day 29: No reset yet
Day 30: âœ… RESET TRIGGERS
        creditsUsed â†’ 0
        creditsResetDate â†’ "2026-01-31"
```

### What Gets Reset?
```
âœ… creditsUsed â†’ 0
âœ… creditsResetDate â†’ updated
âŒ credits â†’ stays same (it's the monthly limit)
âŒ addonCredits â†’ not affected (separate system)
```

---

## ðŸŽ Addon Credits Explained

### What Are Addon Credits?
```
Bonus credits with an expiry date
- Added by admin OR purchased by user
- Have a specific expiry datetime
- Add to total available credits
- Independent of monthly resets
- Don't get consumed (just expire by date)
```

### How Do They Work?
```
Admin adds 10,000 credits expiring March 1:

Day 1:
  addonCredits: 10,000
  addonCreditsExpiryAt: "2026-03-01"
  Status: VALID âœ…
  Added to total: YES

Day 60 (March 1):
  addonCredits: 10,000 (still in database)
  addonCreditsExpiryAt: "2026-03-01" (past date)
  Status: EXPIRED âŒ
  Added to total: NO
```

### Adding More Addon Credits
```
Scenario 1: User has VALID addon credits
  Current: 10,000 (expires Mar 1)
  Adding: 5,000 (expires Apr 1)
  Result: 15,000 (expires Apr 1) âœ… ADDED

Scenario 2: User has EXPIRED addon credits
  Current: 10,000 (expired Feb 1)
  Adding: 5,000 (expires Apr 1)
  Result: 5,000 (expires Apr 1) âœ… REPLACED
```

---

## ðŸ’» Admin Panel Actions

### 1. **Add Addon Credits** ðŸª™
```
Steps:
1. Click Coins icon (ðŸª™) next to user
2. Enter credits amount (e.g., 10000)
3. Set expiry date (default: 30 days from now)
4. Click "Add Credits"

What happens:
- If user has valid addons â†’ ADDS to existing
- If user has expired addons â†’ REPLACES old ones
- Updates Firestore immediately
- User sees new total instantly
```

### 2. **Manage User Limits** âœï¸
```
Options:

Limited (Normal):
  wordLimit: Custom (e.g., 2000)
  credits: Custom (e.g., 50000)
  â†’ Regular user with limits

Unlimited (VIP):
  wordLimit: 999999
  credits: 999999
  plan: "pro"
  â†’ No restrictions

Disabled (Banned):
  wordLimit: 0
  credits: 0
  â†’ Cannot use service
```

### 3. **View User Credits**
```
Table shows:
- Plan Credits (base allowance)
- Addon Credits (bonus + expiry date)
- Credits Used (current cycle)
- Word Limit (per check)
```

---

## ðŸ” Example Scenarios

### Scenario A: New Pro User
```
Day 0: Subscribe to Pro
  â†’ credits: 50000
  â†’ creditsUsed: 0
  â†’ creditsResetDate: "2026-01-01"

Day 5: Check 10,000 words
  â†’ creditsUsed: 10000
  â†’ Available: 40,000

Day 15: Check another 15,000 words
  â†’ creditsUsed: 25000
  â†’ Available: 25,000

Day 30: Monthly reset
  â†’ creditsUsed: 0 (RESET)
  â†’ Available: 50,000 (full again)
```

### Scenario B: Admin Adds Bonus
```
Day 0: Pro user with 50k credits
  â†’ Available: 50,000

Day 5: Admin adds 10k bonus (expires Day 60)
  â†’ addonCredits: 10000
  â†’ Available: 60,000

Day 10: User checks 20k words
  â†’ creditsUsed: 20000
  â†’ Available: 40,000 (60k - 20k)

Day 30: Monthly reset
  â†’ creditsUsed: 0 (RESET)
  â†’ addonCredits: 10000 (still valid)
  â†’ Available: 60,000 (reset + addon)

Day 60: Addon expires
  â†’ addonCredits: ignored (expired)
  â†’ Available: 50,000 (plan only)
```

### Scenario C: Enterprise Account
```
Day 0: Admin creates enterprise account
  â†’ plan: "free"
  â†’ credits: 100000 (custom)
  â†’ creditsUsed: 0

Day 10: Check 30k words
  â†’ creditsUsed: 30000
  â†’ Available: 70,000

Day 30: No reset (not Pro subscription)
  â†’ creditsUsed: still 30000
  â†’ Available: still 70,000

Day 60: Admin adds 50k more
  â†’ credits: 150000 (updated)
  â†’ Available: 120,000 (150k - 30k)
```

---

## ðŸ“± User Dashboard Display

### Credit Breakdown
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ YOUR CREDITS                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Monthly Allowance:   50,000    â•‘
â•‘ Bonus Credits:      +10,000    â•‘
â•‘   Expires: March 1, 2026       â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â•‘
â•‘ Total Available:     60,000    â•‘
â•‘                                â•‘
â•‘ Used This Month:     15,000    â•‘
â•‘ Remaining:           45,000    â•‘
â•‘                                â•‘
â•‘ Next Reset: January 31, 2026   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ðŸ› Troubleshooting

### "Credits not resetting?"
```
Check:
1. Is user Pro with active subscription?
2. Has it been 30+ days since last reset?
3. Is creditsResetDate field present?
4. Check browser console for errors
```

### "Addon credits not showing?"
```
Check:
1. Is addonCreditsExpiryAt in the future?
2. Is addonCredits value > 0?
3. Check Firestore document directly
4. Refresh browser (state sync issue)
```

### "Monthly reset not persisting?"
```
Check:
1. Firestore rules allow user writes
2. updateDoc function imported correctly
3. No console errors during reset
4. creditsResetDate field updated in Firestore
```

---

## âœ… Quick Validation

### For Developers:
```bash
# Check TypeScript errors
npm run build

# Should see: "âœ“ built in Xs" with no errors
```

### For Admins:
```
1. Login to /admin
2. Go to Users tab
3. See "Addon Credits" column
4. Click ðŸª™ icon
5. Add credits with expiry
6. Check user's Available Credits increases
```

### For Users:
```
1. Login to dashboard
2. See credit breakdown
3. Check some text
4. See "Used This Month" increase
5. See "Remaining" decrease
6. After 30 days, see reset
```

---

## ðŸ“Š Database Fields Reference

```javascript
users/{userId} {
  // Plan & Limits
  plan: "pro" | "free"
  wordLimit: 5000                    // Max words per check
  credits: 50000                     // Monthly allowance
  subscriptionStatus: "active"       // Payment status
  subscriptionUpdatedAt: "ISO date"  // Subscription start
  
  // Usage Tracking
  creditsUsed: 15000                 // Consumed this cycle
  creditsResetDate: "ISO date"       // Last reset timestamp
  creditsUpdatedAt: "ISO date"       // Last activity
  
  // Addon Credits
  addonCredits: 10000                // Bonus amount
  addonCreditsExpiryAt: "ISO date"   // When addon expires
  
  // Metadata
  status: "active" | "deactivated"
  createdAt: "ISO date"
  updatedAt: "ISO date"
}
```

---

## ðŸŽ¯ Summary

### Core Principles:
1. **Plan credits = Monthly allowance** (doesn't change)
2. **Usage counter = Consumption tracker** (resets monthly for Pro)
3. **Addon credits = Temporary bonus** (expires by date)
4. **Available = (Plan + Addon) - Used**

### Key Benefits:
- âœ… Simple and clear
- âœ… Easy to understand
- âœ… Flexible for all user types
- âœ… Admin has full control
- âœ… Automatic for Pro users
- âœ… Manual for Enterprise

**Status: PRODUCTION READY** ðŸš€
